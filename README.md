# Director Webhook Server

Instagram Direct webhook —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ª—ñ–¥–∞–º–∏.

## üöÄ –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

- **Instagram API —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è** - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- **PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–∏—Ö** - –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ª—ñ–¥—ñ–≤ —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- **RESTful API** - –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ–¥–∞—Ç–∫—É
- **Webhook –æ–±—Ä–æ–±–∫–∞** - —Ä–µ–∞–ª—å–Ω–∏–π —á–∞—Å –æ–±—Ä–æ–±–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- **–®–∞–±–ª–æ–Ω–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å** - –≥–æ—Ç–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

- Node.js
- Express.js
- PostgreSQL
- Instagram Graph API
- CORS
- node-fetch

## üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### 1. –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
```bash
git clone https://github.com/neskorodko/director-webhook.git
cd director-webhook
```

### 2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
```bash
npm install
```

### 3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

–°—Ç–≤–æ—Ä—ñ—Ç—å `.env` —Ñ–∞–π–ª:

```env
# Database
DATABASE_URL=postgresql://user:password@localhost:5432/director

# Instagram API
VERIFY_TOKEN=your_verify_token
PAGE_ACCESS_TOKEN=your_page_access_token

# Your Instagram account ID (to prevent saving your own messages as leads)
OWN_INSTAGRAM_ID=your_instagram_user_id

# Server
PORT=3000
```

**–í–∞–∂–ª–∏–≤–æ:** `OWN_INSTAGRAM_ID` - —Ü–µ ID –≤–∞—à–æ–≥–æ –≤–ª–∞—Å–Ω–æ–≥–æ Instagram –∞–∫–∫–∞—É–Ω—Ç—É. –û—Ç—Ä–∏–º–∞—Ç–∏ –π–æ–≥–æ –º–æ–∂–Ω–∞ —á–µ—Ä–µ–∑ Graph API:
```bash
curl "https://graph.facebook.com/me?access_token=YOUR_PAGE_ACCESS_TOKEN"
```

### 4. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

–í–∏–∫–æ–Ω–∞–π—Ç–µ –º—ñ–≥—Ä–∞—Ü—ñ—ó –∑ –ø–∞–ø–∫–∏ `migrations/`:

```sql
-- 000_init.sql - –±–∞–∑–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ
-- 001_create_templates.sql - —à–∞–±–ª–æ–Ω–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
-- 002_add_lead_statuses.sql - —Ä–æ–∑—à–∏—Ä–µ–Ω—ñ —Å—Ç–∞—Ç—É—Å–∏ –ª—ñ–¥—ñ–≤
```

#### –°—Ç–∞—Ç—É—Å–∏ –ª—ñ–¥—ñ–≤:
- `NEW` - –ù–æ–≤–∏–π –ª—ñ–¥
- `CONTACTED` - –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç
- `QUALIFIED` - –ö–≤–∞–ª—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –ª—ñ–¥
- `PROPOSAL` - –ù–∞–¥—ñ—Å–ª–∞–Ω–æ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—é
- `NEGOTIATION` - –ü–µ—Ä–µ–≥–æ–≤–æ—Ä–∏
- `CLOSED_WON` - –£—Å–ø—ñ—à–Ω–æ –∑–∞–∫—Ä–∏—Ç–æ
- `CLOSED_LOST` - –í—Ç—Ä–∞—á–µ–Ω–æ
- `ON_HOLD` - –ù–∞ –ø–∞—É–∑—ñ
- `FOLLOW_UP` - –ü–æ—Ç—Ä–µ–±—É—î –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç—É

## üöÄ –ó–∞–ø—É—Å–∫

### –†–æ–∑—Ä–æ–±–∫–∞
```bash
npm start
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞ `http://localhost:3000`

### –ü—Ä–æ–¥–∞–∫—à–Ω
```bash
NODE_ENV=production npm start
```

## üîß API Endpoints

### Webhook
- `GET /webhook` - –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è webhook
- `POST /webhook` - –æ–±—Ä–æ–±–∫–∞ –≤—Ö—ñ–¥–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

### –õ—ñ–¥–∏
- `GET /leads` - –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –ª—ñ–¥—ñ–≤ (–∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—î—é –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º)
- `GET /leads/:id` - –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª—ñ–¥–∞
- `PATCH /leads/:id` - –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –ª—ñ–¥–∞
- `GET /lead-statuses` - –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Å—Ç–∞—Ç—É—Å—ñ–≤

### –ß–∞—Ç–∏
- `GET /chats/:id` - –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —á–∞—Ç—É
- `POST /chats/:id/send` - –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- `POST /chats/:id/sync` - —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑ Instagram

### –®–∞–±–ª–æ–Ω–∏
- `GET /templates` - –æ—Ç—Ä–∏–º–∞—Ç–∏ —à–∞–±–ª–æ–Ω–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- `POST /templates` - —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π —à–∞–±–ª–æ–Ω
- `PUT /templates/:id` - –æ–Ω–æ–≤–∏—Ç–∏ —à–∞–±–ª–æ–Ω
- `DELETE /templates/:id` - –≤–∏–¥–∞–ª–∏—Ç–∏ —à–∞–±–ª–æ–Ω

## üì± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

### –¢–∞–±–ª–∏—Ü—è `leads`
- `id` - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä
- `ig_id` - Instagram ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `username` - Instagram username
- `full_name` - –ø–æ–≤–Ω–µ —ñ–º'—è
- `first_seen` - –¥–∞—Ç–∞ –ø–µ—Ä—à–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç—É
- `status` - —Å—Ç–∞—Ç—É—Å –ª—ñ–¥–∞

### –¢–∞–±–ª–∏—Ü—è `messages`
- `id` - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä
- `lead_id` - –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ª—ñ–¥–∞
- `text` - —Ç–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- `direction` - –Ω–∞–ø—Ä—è–º–æ–∫ (inbound/outbound)
- `timestamp` - —á–∞—Å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

### –¢–∞–±–ª–∏—Ü—è `message_templates`
- `id` - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä
- `name` - –Ω–∞–∑–≤–∞ —à–∞–±–ª–æ–Ω—É
- `content` - –∑–º—ñ—Å—Ç —à–∞–±–ª–æ–Ω—É
- `category` - –∫–∞—Ç–µ–≥–æ—Ä—ñ—è

## üîê –ë–µ–∑–ø–µ–∫–∞

- –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è webhook —Ç–æ–∫–µ–Ω—ñ–≤
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Å—ñ—Ö –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
- –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ API
- –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ SQL —ñ–Ω'—î–∫—Ü—ñ–π

## üìä –õ–æ–≥—É–≤–∞–Ω–Ω—è

–°–µ—Ä–≤–µ—Ä –ª–æ–≥—É—î –≤—Å—ñ –≤–∞–∂–ª–∏–≤—ñ –ø–æ–¥—ñ—ó:
- –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- –ü–æ–º–∏–ª–∫–∏ API
- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î

## üöÄ –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

### Render.com
1. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
2. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
3. –í–∏–±–µ—Ä—ñ—Ç—å Node.js —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ
4. –†–æ–∑–≥–æ—Ä–Ω—ñ—Ç—å —Å–µ—Ä–≤—ñ—Å

### Heroku
```bash
heroku create your-app-name
heroku config:set DATABASE_URL=your_db_url
heroku config:set PAGE_ACCESS_TOKEN=your_token
git push heroku main
```

## ü§ù –í–Ω–µ—Å–æ–∫ —É –ø—Ä–æ–µ–∫—Ç

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
2. –°—Ç–≤–æ—Ä—ñ—Ç—å feature branch
3. –ó—Ä–æ–±—ñ—Ç—å –∑–º—ñ–Ω–∏
4. –°—Ç–≤–æ—Ä—ñ—Ç—å Pull Request

## üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è

MIT License 